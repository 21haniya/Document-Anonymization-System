editor_panel.html 

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Edit√∂r Paneli</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 40px 20px;
            padding: 80px 20px 40px;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        h1 {
            text-align: center;
            color: #343a40;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
        }

        th {
            background-color: #f4a261;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        a {
            color: #f4a261;
            font-weight: 500;
            text-decoration: none;
            margin: 4px;
            display: inline-block;
        }

        a:hover {
            text-decoration: underline;
        }

        .actions a {
            margin: 0 4px;
        }

        .navbar {
            background-color: #f4a261;
            padding: 10px 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: center;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="{% url 'anasayfa' %}">üè† Ana Sayfa</a>
    </nav>

    <div class="container">
        <h1>üìÑ Y√ºklenen Makaleler</h1>

        <div style="text-align: right; margin-bottom: 15px;">
            <a href="{% url 'anonim_makaleler' %}" style="
                padding: 10px 20px;
                background-color: #2a9d8f;
                color: white;
                text-decoration: none;
                border-radius: 8px;
                font-weight: 500;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            ">üìÇ Anonimle≈ütirilmi≈ü Makaleleri G√∂ster</a>
            <a href="{% url 'tum_log_kaydi' %}" style="
                padding: 10px 20px;
                background-color: #6c757d;
                color: white;
                text-decoration: none;
                border-radius: 8px;
                font-weight: 500;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                margin-left: 10px;
            ">üßæ Log Takip</a>
            
            
        
        </div>     
        

        <table>
            <thead>
                <tr>
                    <th>Takip Numarasƒ±</th>
                    <th>E-posta</th>
                    <th>Y√ºkleme Tarihi</th>
                    <th>PDF</th>
                    <th>Konu</th>
                    <th>ƒ∞≈ülemler</th>
                    <th>Anonim Makale</th>
                    <th>Durum</th>
                </tr>
            </thead>
            <tbody>
                {% for makale in makaleler %}
                <tr>
                    <td class="info">
                        <a href="javascript:void(0);" onclick="openMessageModal('{{ makale.takip_numarasi }}')">
                            {{ makale.takip_numarasi }}
                        </a>
                    </td>
                    
                    <td>{{ makale.email }}</td>
                    <td>{{ makale.yuklenme_tarihi }}</td>
                    <td><a href="{{ makale.pdf.url }}" download>ƒ∞ndir</a></td>
                    <td>
                        {% if makale.benzersiz_ana_basliklar %}
                            {% for baslik in makale.benzersiz_ana_basliklar %}
                                <div>{{ baslik }}</div>
                            {% endfor %}
                        {% else %}
                            <span style="color:#aaa;">Belirlenmemi≈ü</span>
                        {% endif %}
                    </td>                                   
                    <td class="actions">
                        
                        <a href="javascript:void(0);" onclick="openAnonFormModal('{{ makale.takip_numarasi }}')">Anonimle≈ütir</a> |
                        <a href="javascript:void(0);" onclick="showKeywords('{{ makale.takip_numarasi }}')">Anahtar Kelimeler</a> |
                        <a href="{% url 'hakem_oner' makale.takip_numarasi %}" 
                        {% if not makale.anonim_pdf %} style="pointer-events:none; color: #ccc;" title="√ñnce anonimle≈ütirme yapmalƒ±sƒ±nƒ±z" {% endif %}>
                        Hakem Ata</a> |
                        <a href="{% url 'final_pdf_yukle' makale.takip_numarasi %}"
                        {% if makale.status != "Deƒüerlendirildi" %}
                            style="pointer-events: none; color: #ccc; text-decoration: none; cursor: default;"
                            title="√ñnce hakem deƒüerlendirmesi yapƒ±lmalƒ±dƒ±r"
                        {% endif %}>
                        Final Kaydet
                        </a>
                        
                        <a href="{% url 'deanonimlestir' makale.takip_numarasi %}" 
                        {% if not makale.anonim_pdf %} style="pointer-events:none; color:#ccc;" title="√ñnce anonimle≈ütirme yapƒ±lmalƒ±" {% endif %}>
                        De-anonimle≈ütir</a> |
                        <a href="javascript:void(0);" onclick="openMessageModal('{{ makale.takip_numarasi }}')">üí¨ Mesajla≈ü</a>


                    </td>
                    <td>
                        {% if makale.anonim_pdf %}
                          <a href="{{ makale.anonim_pdf.url }}" download>ƒ∞ndir</a>
                        {% else %}
                          <span style="color:#aaa;">Yok</span>
                        {% endif %}
                    </td>     
                    <td>
                        {% if makale.status == "Atandƒ±" %}
                          <span style="color:#007bff;">Hakeme Atandƒ±</span>
                        {% elif makale.status == "Deƒüerlendirildi" %}
                          <span style="color:#28a745;">Deƒüerlendirildi</span>
                        {% else %}
                          <span style="color:#6c757d;">Beklemede</span>
                        {% endif %}
                      </td>
                      
                    
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    
    <!-- Anonimle≈ütirme Modalƒ± -->
    <div id="anonFormModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    background:#ffffff; padding:30px; border-radius:14px; box-shadow:0 8px 24px rgba(0,0,0,0.2); z-index:1000; width:400px; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
        
        <h2 style="text-align:center; color:#343a40; font-size:20px; margin-bottom:20px;">
            Hangi t√ºrde bilgileri anonimle≈ütirmek istiyorsunuz?
        </h2>

        <form id="anonModalForm" style="display:flex; flex-direction:column; gap:12px;">
            {% csrf_token %}
            <input type="hidden" name="takip_no" id="modalTakipNo">

            <label style="font-size:15px; color:#555;">
                <input type="checkbox" name="turlar" value="PERSON" checked style="margin-right:10px;">
                Yazar Ad-Soyad (PERSON)
            </label>
            <label style="font-size:15px; color:#555;">
                <input type="checkbox" name="turlar" value="ORG" checked style="margin-right:10px;">
                Kurum Bilgisi (ORG)
            </label>
            <label style="font-size:15px; color:#555;">
                <input type="checkbox" name="turlar" value="EMAIL" checked style="margin-right:10px;">
                E-posta Bilgisi (EMAIL)
            </label>
            <label style="font-size:15px; color:#555;">
                <input type="checkbox" name="turlar" value="GPE" style="margin-right:10px;">
                Coƒürafi Yer (≈ûehir vb.) (GPE)
            </label>

            <button type="submit" style="margin-top:15px; background-color:#f4a261; color:white;
            padding:10px; font-size:14px; border:none; border-radius:6px; cursor:pointer; transition:background-color 0.3s ease;">
                PDF'yi Anonimle≈ütir
            </button>
        </form>
        <p id="anonLoading" style="display:none; color:#888; margin-top:10px;">‚è≥ ƒ∞≈ülem yapƒ±lƒ±yor, l√ºtfen bekleyin...</p>

    </div>

    <!-- Mesajla≈üma Modalƒ± -->
    <div id="messageModal" style="display:none; position:fixed; bottom:0; right:20px; width:340px; background:white; border:1px solid #ccc; border-radius:12px 12px 0 0; box-shadow:0 0 12px rgba(0,0,0,0.2); z-index:1001;">
        <div style="padding:10px; background:#f4a261; color:white; border-radius:12px 12px 0 0;">
            <strong>Yazarla Mesajla≈ü</strong>
            <span onclick="closeMessageModal()" style="float:right; cursor:pointer;">‚úñ</span>
        </div>
        <div id="messageList" style="max-height:200px; overflow-y:auto; padding:10px;">
            <p style="text-align:center;">Y√ºkleniyor...</p>
        </div>

        <form id="editorMessageForm" method="post" style="padding:10px;">
            {% csrf_token %}
            <textarea name="icerik" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..." required></textarea>
            <input type="hidden" name="gonderen" value="EDITOR">
            <button type="submit" style="margin-top:5px;">G√∂nder</button>
        </form>
    </div>


    <!-- Arka Plan Overlay -->
    <div id="anonFormOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.3); z-index:999;" onclick="closeAnonFormModal()"></div>



    <!-- Sayfanƒ±n en altƒ±na ekle -->
    <div id="keywordModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    background:#fff; padding:25px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.2); z-index:1000; width:400px;">
        <h2 style="margin-top:0; font-size:18px; color:#333;">üìå Anahtar Kelimeler</h2>
        <ul id="keywordList" style="padding-left:20px;"></ul>
        <p id="noKeywords" style="color:#c0392b; font-weight:500; display:none;">‚ùå Herhangi bir anahtar kelime bulunamadƒ±.</p>
        <button onclick="closeModal()" style="margin-top:15px; padding:6px 12px; border:none; background:#f4a261; color:white; border-radius:8px;">Kapat</button>
    </div>

    <!-- Modal arkaplanƒ±nƒ± karartmak i√ßin -->
    <div id="modalOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;" onclick="closeModal()"></div>

    <script>
        // BURAYA JavaScript kodlarƒ± gelecek
        function showKeywords(takipNo) {
            fetch(`/anahtar-kelimeler-json/${takipNo}/`)
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById("keywordList");
                    const noData = document.getElementById("noKeywords");
                    list.innerHTML = "";
    
                    if (data.keywords && data.keywords.length > 0) {
                        noData.style.display = "none";
                        data.keywords.forEach(kw => {
                            const li = document.createElement("li");
                            li.textContent = kw;
                            list.appendChild(li);
                        });
                    } else {
                        noData.style.display = "block";
                    }
    
                    document.getElementById("keywordModal").style.display = "block";
                    document.getElementById("modalOverlay").style.display = "block";
                })
                .catch(err => {
                    alert("Anahtar kelimeler alƒ±namadƒ±.");
                });
        }
    
        function closeModal() {
            document.getElementById("keywordModal").style.display = "none";
            document.getElementById("modalOverlay").style.display = "none";
        }

    </script>

    <script>
        function openAnonFormModal(takipNo) {
            document.getElementById("modalTakipNo").value = takipNo;
            document.getElementById("anonFormModal").style.display = "block";
            document.getElementById("anonFormOverlay").style.display = "block";
        }

        function closeAnonFormModal() {
            document.getElementById("anonFormModal").style.display = "none";
            document.getElementById("anonFormOverlay").style.display = "none";
        }

        document.getElementById("anonModalForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const form = e.target;
            const takipNo = document.getElementById("modalTakipNo").value;
            
            const formData = new FormData(form);
            const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;

            document.getElementById("anonLoading").style.display = "block";


            fetch(`/anonimlestir/${takipNo}/`, {
                method: "POST",
                headers: { 'X-CSRFToken': csrfToken },
                body: formData,
            })

            .then(res => res.json())
            .then(data => {
                document.getElementById("anonLoading").style.display = "none";

                if (data.success) {
                    alert("‚úÖ Anonimle≈ütirme tamamlandƒ±. Dosya indiriliyor...");
                    window.open(data.download_url, "_blank");

                    // PDF ba≈üarƒ±yla olu≈üturulunca sayfayƒ± yenileyerek indir butonunu g√∂ster
                    // Belirli satƒ±rƒ± g√ºncellemek i√ßin doƒürudan DOM manip√ºlasyonu yapabilirsin
                    const row = document.querySelector(`td.info:contains('${takipNo}')`);
                    if (row) {
                        row.closest("tr").querySelector("td:last-child").innerHTML = '<span style="color:#28a745;">Deƒüerlendirildi</span>';
                    }

                } else {
                    alert("‚ùå Anonimle≈ütirme ba≈üarƒ±sƒ±z.");
                }
                closeAnonFormModal();
            })
            .catch(err => {
                document.getElementById("anonLoading").style.display = "none";
                alert("‚ö†Ô∏è Bir hata olu≈ütu.");
                closeAnonFormModal();
            });
        });

    </script>

    <div id="messageModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:white; border-radius:12px; width:400px; box-shadow:0 0 16px rgba(0,0,0,0.3); z-index:9999;">
        <div style="background:#f4a261; padding:10px; color:white; border-radius:12px 12px 0 0;">
            <strong>üì® Mesajla≈üma</strong>
            <span onclick="closeMessageModal()" style="float:right; cursor:pointer;">‚úñ</span>
        </div>
        <div id="messageContent" style="max-height:300px; overflow-y:auto; padding:15px;">
            ‚è≥ Y√ºkleniyor...
        </div>
    </div>
    <div id="messageOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.3); z-index:9998;" onclick="closeMessageModal()"></div>
  
    
  <script>
    function openMessageModal(takipNo) {
        document.getElementById("messageModal").style.display = "block";
        document.getElementById("messageOverlay").style.display = "block";
    
        // Fetch mesaj kutusu
        fetch(`/mesaj-paneli/${takipNo}/?rol=EDITOR`)
            .then(res => res.text())
            .then(html => {
                document.getElementById("messageContent").innerHTML = html;
            })
            .catch(err => {
                document.getElementById("messageContent").innerHTML = "<p style='color:red;'>Mesajlar y√ºklenemedi.</p>";
            });
    }
    
    function closeMessageModal() {
        document.getElementById("messageModal").style.display = "none";
        document.getElementById("messageOverlay").style.display = "none";
    }
    </script>
    
    <script>
        function openMessageModal(takipNo) {
            document.getElementById("messageModal").style.display = "block";
    
            fetch(`/editor/mesaj/${takipNo}/`)
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, "text/html");
                    const messages = doc.getElementById("messageList").innerHTML;
                    document.getElementById("messageList").innerHTML = messages;
                    scrollToBottom();
                });
        }
    
        function closeMessageModal() {
            document.getElementById("messageModal").style.display = "none";
        }
    
        function scrollToBottom() {
            const box = document.getElementById("messageList");
            box.scrollTop = box.scrollHeight;
        }
    
        document.getElementById("editorMessageForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
            const takipNo = form.getAttribute("data-takip");
    
            fetch(window.location.href, {
                method: "POST",
                headers: { "X-CSRFToken": csrfToken },
                body: formData
            })
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, "text/html");
                const newMessages = doc.getElementById("messageList").innerHTML;
                document.getElementById("messageList").innerHTML = newMessages;
                form.reset();
                scrollToBottom();
            });
        });
    </script>
    


</body>
</html>